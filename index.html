<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/th.js"></script>
    <link href='//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet'/>
    <link rel="stylesheet" href="style.css">
    <title>แบบสำรวจสิ่งแวดล้อม (วล.02)</title>
    
</head>
<body>
   <form method="POST" action="https://script.google.com/macros/s/AKfycbw-fL3fqR6QeTqlABQtz3A2S0gfn99sFDwYnv8SabOa8iujBfzexaxs6EMG3gaFGrKj/exec" accept-charset="UTF-8" autocomplete="off" name="แบบสำรวจผู้แทน">

        <div id="content">
        
        <div class="container">
            <div style="text-align: right;" >วล.02 (แก้ไขครั้งที่ 03)</div>
            <div class="main_title"><h1><b>แบบสำรวจสิ่งแวดล้อม</b></h1></div>

            <div class="inline-group">
                <div class="sub_title">
                    <span for="ครั้งที่สำรวจ"><b>ครั้งที่สำรวจ :</b></span>
                    <input class="underline-inputF" placeholder="เลือกครั้งที่สำรวจ" list="ครั้งที่" required autocomplete="off" id="ครั้งที่สำรวจ" name="ครั้งที่สำรวจ">
                        <datalist id="ครั้งที่">
                        <option value="1/ 2568">
                        <option value="2/ 2568">
                        <option value="3/ 2568">
                        <option value="4/ 2568">
                        </datalist>
                </div>

                <div class="sub_title" >
                    <label for="thaiDate"><b>วันที่ทำการสำรวจ :</b></label>
                    <input id="thaiDate" class="underline-inputF" type="text" placeholder="เลือกวันที่" name="วันที่ทำการสำรวจ">
                </div>

                <div class="sub_title">
                <span for="สถานที่"><b>สถานที่ :</b></span>
                <input class="underline-inputF"  placeholder="เลือกสถานที่" list="หน่วยงาน" required autocomplete="off" id="สถานที่" name="สถานที่">
                    <datalist id="หน่วยงาน">
                        <option value="โรงอาหาร ทกท.1">
                        <option value="โรงอาหาร ทกท.2">
                        <option value="โรงอาหาร ทกท.3">
                        <option value="โรงอาหาร ทกท.4">
                        <option value="รส.3">
                        <option value="รส.4">
                        <option value="รส.5"> 
                        <option value="รส.6">
                        <option value="รส.7"> 
                        <option value="รส.8">
                        <option value="รส.9">
                        <option value="รส.11">
                        <option value="รส.13">
                        <option value="รส.15">
                        <option value="รส.16">
                        <option value="รส.17">
                        <option value="คท.">
                        <option value="คผ.">
                        <option value="คสร."> 
                        <option value="คอ.">
                        <option value="คต.">
                        <option value="ผสท.กปส.3">
                        <option value="ผสอ.">
                        <option value="คตป.">
                        <option value="คบต.">
                        <option value="กตส.1">
                        <option value="กตส.2">
                        <option value="ซท.1">
                        <option value="ซท.2">
                        <option value="ซท.3">
                        <option value="ปภ."> 
                    </datalist>
                </div>   
            </div>
         
        
            <table>

                <tr class="head-table">
                    <th rowspan="2" ><center>เรื่อง</center></th>
                    <th rowspan="2" style="width: 30%;"><center>รายละเอียดการสำรวจ</center></th>
                    <th colspan="3"><center>ผลการสำรวจ</center></th>
                    <th rowspan="3" ><center>แนวทางการดำเนินการแก้ไข</center></th>
                </tr>
                <tr class="head-table">
                    <th style="width: 5%;">ผ่าน</th>
                    <th style="width: 5%;">ไม่ผ่าน</th>
                    <th >สิ่งที่พบ</th>   
                </tr>

                <tr>
                    <th rowspan="4">1. ความสะอาด</th>
                </tr>

                <tr>
                    <td>1.1 อาคารและบริเวณโดยรอบสะอาด</td>
                    <td class="in"><input type="radio"  name="1.1 อาคารและบริเวณโดยรอบสะอาด" value="ผ่าน"></td>
                    <td class="in"><input type="radio"  name="1.1 อาคารและบริเวณโดยรอบสะอาด" value="ไม่ผ่าน"></td>
                    <td class="in"><input class="underline-input" type="text" name="1.1 สิ่งที่พบ"> </td>
                    <td class="in"><input class="underline-input" type="text" name="1.1 แนวทางแก้ไข"> </td>
                </tr>
                <tr>
                    <td>1.2 อุปกรณ์ของใช้สะอาดและอยู่ในสภาพดี</td>
                    <td class="in"><input type="radio" name="1.2 อุปกรณ์ของใช้สะอาดและอยู่ในสภาพดี" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="1.2 อุปกรณ์ของใช้สะอาดและอยู่ในสภาพดี" value="ไม่ผ่าน"></td>
                    <td class="in"><input class="underline-input" type="text" name="1.2 สิ่งที่พบ"> </td>
                    <td class="in"><input class="underline-input" type="text" name="1.2 แนวทางแก้ไข"> </td>
                </tr>
                <tr>
                    <td>1.3 มีการจัดวางสิ่งของเป็นระเบียบเรียบร้อย</td>
                    <td class="in"><input type="radio" name="1.3 มีการจัดวางสิ่งของเป็นระเบียบเรียบร้อย" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="1.3 มีการจัดวางสิ่งของเป็นระเบียบเรียบร้อย" value="ไม่ผ่าน"></td>
                    <td class="in"><input class="underline-input" type="text" name="1.3 สิ่งที่พบ"> </td>
                    <td class="in"><input class="underline-input" type="text" name="1.3 แนวทางแก้ไข"> </td>
                </tr>
                <tr>
                    <th rowspan="6">2. ขยะ</th>
                </tr>
                <tr>
                    <td>2.1 ที่รองรับขยะถูกหลักสุขาภิบาล</td>
                    <td class="in"><input type="radio" name="2.1 ที่รองรับขยะถูกหลักสุขาภิบาล" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="2.1 ที่รองรับขยะถูกหลักสุขาภิบาล" value="ไม่ผ่าน"></td>
                    <td class="in"><input class="underline-input" type="text" name="2.1 สิ่งที่พบ"> </td>
                    <td class="in"><input class="underline-input" type="text" name="2.1 แนวทางแก้ไข"> </td>
                </tr>
                <tr>
                    <td>2.2 ที่รองรับขยะมีจำนวนเพียงพอ</td>
                    <td class="in"><input type="radio" name="2.2 ที่รองรับขยะมีจำนวนเพียงพอ" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="2.2 ที่รองรับขยะมีจำนวนเพียงพอ" value="ไม่ผ่าน"></td>
                    <td class="in"><input class="underline-input" type="text" name="2.2 สิ่งที่พบ"> </td>
                    <td class="in"><input class="underline-input" type="text" name="2.2 แนวทางแก้ไข"> </td>
                </tr>
                <tr>
                    <td>2.3 มีการคัดแยกประเภทขยะ</td>
                    <td class="in"><input type="radio" name="2.3 มีการคัดแยกประเภทขยะ" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="2.3 มีการคัดแยกประเภทขยะ" value="ไม่ผ่าน"></td>
                    <td class="in"><input class="underline-input" type="text" name="2.3 สิ่งที่พบ"> </td>
                    <td class="in"><input class="underline-input" type="text" name="2.3 แนวทางแก้ไข"> </td>
                </tr>
                <tr>
                    <td>2.4 มีการคัดแยกประเภทขยะ</td>
                    <td class="in"><input type="radio" name="2.4 มีการคัดแยกประเภทขยะ" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="2.4 มีการคัดแยกประเภทขยะ" value="ไม่ผ่าน"></td>
                    <td class="in"><input class="underline-input" type="text" name="2.4 สิ่งที่พบ"> </td>
                    <td class="in"><input class="underline-input" type="text" name="2.4 แนวทางแก้ไข"> </td>
                </tr>
                <tr>
                    <td>2.5 ขยะไม่ส่งกลิ่นเหม็นรบกวน</td>
                    <td class="in"><input type="radio" name="2.5 ขยะไม่ส่งกลิ่นเหม็นรบกวน" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="2.5 ขยะไม่ส่งกลิ่นเหม็นรบกวน" value="ไม่ผ่าน"></td>
                    <td class="in"><input class="underline-input" type="text" name="2.5 สิ่งที่พบ"> </td>
                    <td class="in"><input class="underline-input" type="text" name="2.5 แนวทางแก้ไข"> </td>
                </tr>

                <tr>
                    <th rowspan="4">3. น้ำเสีย</th>
                </tr>
                <tr>
                    <td>3.1 ท่อ/ รางระบายน้ำอยู่ในสภาพดี ไม่อุดตัน</td>
                    <td class="in"><input type="radio" name="3.1 ท่อ/ รางระบายน้ำอยู่ในสภาพดี ไม่อุดตัน" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="3.1 ท่อ/ รางระบายน้ำอยู่ในสภาพดี ไม่อุดตัน" value="ไม่ผ่าน"></td>
                    <td class="in"><input class="underline-input" type="text" name="3.1 สิ่งที่พบ"> </td>
                    <td class="in"><input class="underline-input" type="text" name="3.1 แนวทางแก้ไข"> </td>
                </tr>
                <tr>
                    <td>3.2 มีการบำบัดน้ำเสียขั้นต้น เช่น ระบบบำบัดน้ำเสีย ถังดักไขมัน</td>
                    <td class="in"><input type="radio" name="3.2 มีการบำบัดน้ำเสียขั้นต้น เช่น ระบบบำบัดน้ำเสีย ถังดักไขมัน" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="3.2 มีการบำบัดน้ำเสียขั้นต้น เช่น ระบบบำบัดน้ำเสีย ถังดักไขมัน" value="ไม่ผ่าน"></td>
                    <td class="in"><input class="underline-input" type="text" name="3.2 สิ่งที่พบ"> </td>
                    <td class="in"><input class="underline-input" type="text" name="3.2 แนวทางแก้ไข"> </td>
                </tr>
                <tr>
                    <td>3.3 ระบบบำบัดน้ำเสียใช้งานได้ปกติ</td>
                    <td class="in"><input type="radio" name="3.3 ระบบบำบัดน้ำเสียใช้งานได้ปกติ" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="3.3 ระบบบำบัดน้ำเสียใช้งานได้ปกติ" value="ไม่ผ่าน"></td>
                    <td class="in"><input class="underline-input" type="text" name="3.3 สิ่งที่พบ"> </td>
                    <td class="in"><input class="underline-input" type="text" name="3.3 แนวทางแก้ไข"> </td>
                </tr>
                
            </table>

            
        
            
           
            <div class="suggest">
                <label for="ข้อเสนอแนะ"><b>ข้อเสนอแนะ :</b></label>
                <input class="underline-suggest" type="text" name="ข้อเสนอแนะ" id="ข้อเสนอแนะ">   
                
            </div>

           <br> 
        
            <div class="wrapper">
                <!-- กล่องซ้าย -->
                <div class="left-box">
                    <label for="ชื่อผู้สำรวจ"><b>ชื่อผู้สำรวจ :</b></label>
                    <input class="underline-inputw" list="รายชื่อ" placeholder="เลือกชื่อผู้สำรวจ" required autocomplete="off" id="ชื่อผู้สำรวจ" name="ชื่อผู้สำรวจ">
                    <datalist id="รายชื่อ">
                    <option value="พนิตพิชา วัยคุณา">
                    <option value="ณัทฐา ภักดีประเสริฐ">
                    <option value="อิงกมล แสงสินชัย">
                    <option value="ณพล สารศาสตร์บัญชา">
                    <option value="ธนกร อินทรีเนตร">
                    <option value="ปฏิมา ใช้ช่ำชอง">
                    <option value="เตวิช ธงศิลา">
                    </datalist>

                    <br><br>

                    <label for="ตำแหน่ง"><b>ตำแหน่ง :</b></label>
                    <input class="underline-inputw" list="Position" placeholder="ระบุตำแหน่ง" required autocomplete="off" id="ตำแหน่ง" name="ตำแหน่ง">
                    <datalist id="Position">
                    <option value="หัวหน้าแผนก">
                    <option value="ผู้ช่วยหัวหน้าแผนก">
                    <option value="หม.ประเมินผลฯ">
                    <option value="หม.วางแผนงานฯ">
                    <option value="นักวิชาการ 6">
                    </datalist>

                    <br><br>
                    
                    <div class="box_button">
                        <button class="bt" type="button" onclick="printWithCustomFilename()">Print PDF</button>
                        <button class="bt" type="button" onclick="resetForm() ,clearSignature()">ล้างฟอร์ม</button>
                        <button class="bt" type="submit">ส่งข้อมูล</button>
                    </div>
                </div>

                <!-- กล่องขวา -->
                <div class="right-box">
                    <label><b>เจ้าของสถานที่รับทราบ :</b></label>
                    <canvas id="signature-pad" class="signature-pad"></canvas>
                    
                    <div class="btn-group">
                        <button class="bt" type="button" onclick="clearSignature()">ล้างลายเซ็น</button>
                    </div>

                    <label for="ชื่อผู้ลงนามเจ้าของสถานที่"><b>ชื่อ :</b></label>
                    <input class="underline-inputw" type="text" placeholder="ชื่อ - สกุล" id="ชื่อผู้ลงนามเจ้าของสถานที่" name="ชื่อผู้ลงนามเจ้าของสถานที่">
                    <br>
                    <label for="ตำแหน่งเจ้าของสถานที่"><b>ตำแหน่ง :</b></label>
                    <input class="underline-inputw" list="PositionArea" placeholder="ระบุตำแหน่ง" required autocomplete="off" id="ตำแหน่งเจ้าของสถานที่" name="ตำแหน่งเจ้าของสถานที่">
                    <datalist id="PositionArea">
                    <option value="หัวหน้าแผนก">
                    <option value="ผู้ช่วยหัวหน้าแผนก">
                    <option value="หัวหน้าหมวดฯ">
                    <option value="พนักงานการสินค้า 8">
                    <option value="พนักงานการสินค้า 6">
                    <option value="พนักงานการสินค้า 5">
                    </datalist>
                </div>
                </div> 
            </div>
            
            </div>
            
           
         
         
            
            <p id="demo"></p>

        </div>  
        </div>
        

    </form>
</body>
<script>
    
    const form = document.forms['แบบสำรวจผู้แทน'];
    form.addEventListener('submit', e => {
        e.preventDefault();
        fetch(form.action, {
            method: 'POST',
            body: new FormData(form)
        }).then(response => {
            alert('ส่งข้อมูลสำเร็จ');
            form.reset();
        }).catch(error => {
            alert('เกิดข้อผิดพลาด กรุณาลองใหม่');
            console.error('Error!', error.message);
        });
    });

    // 1. Map ชื่อ → ตำแหน่ง
    const namePositionMap = {
        "เตวิช ธงศิลา": "นักวิชาการ 6",
        "ปฏิมา ใช้ช่ำชอง": "นักวิชาการ 6",
        "ธนกร อินทรีเนตร": "นักวิชาการ 6",
        "ณพล สารศาสตร์บัญชา": "นักวิชาการ 6",
        "พนิตพิชา วัยคุณา": "หัวหน้าแผนก",
        "ณัทฐา ภักดีประเสริฐ": "ผู้ช่วยหัวหน้าแผนก",
        "อิงกมล แสงสินชัย": "หัวหน้าหมวดประเมินผลฯ",
    };

    document.getElementById("ชื่อผู้สำรวจ").addEventListener("input", function () {
        const selectedName = this.value;
        const positionInput = document.getElementById("ตำแหน่ง");
        positionInput.value = namePositionMap[selectedName] || "";
    });

    // 2. Signature Pad รองรับ mouse + touch
    const canvas = document.getElementById('signature-pad');
    const ctx = canvas.getContext('2d');
    let drawing = false;

    function resizeCanvas() {
    const ratio = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();

    canvas.width = rect.width * ratio;
    canvas.height = rect.height * ratio;

    canvas.style.width = rect.width + 'px';
    canvas.style.height = rect.height + 'px';

    ctx.setTransform(1, 0, 0, 1, 0, 0); // reset
    ctx.scale(ratio, ratio);
}

resizeCanvas(); // เรียกใช้ทันทีตอนโหลดหน้า

    // Mouse events
    canvas.addEventListener('mousedown', e => {
        drawing = true;
        ctx.beginPath();
        ctx.moveTo(e.offsetX, e.offsetY);
    });

    canvas.addEventListener('mousemove', e => {
        if (drawing) {
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.stroke();
        }
    });

    canvas.addEventListener('mouseup', () => drawing = false);
    canvas.addEventListener('mouseleave', () => drawing = false);

    // Touch events
    canvas.addEventListener('touchstart', e => {
        e.preventDefault();
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        ctx.beginPath();
        ctx.moveTo(touch.clientX - rect.left, touch.clientY - rect.top);
        drawing = true;
    });

    canvas.addEventListener('touchmove', e => {
        e.preventDefault();
        if (drawing) {
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
            ctx.stroke();
        }
    });

    canvas.addEventListener('touchend', () => drawing = false);
    canvas.addEventListener('touchcancel', () => drawing = false);

    function clearSignature() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // 3. Print with custom filename
    function printWithCustomFilename() {
        const location = document.getElementById('สถานที่').value;
        const surveyRound = document.getElementById('ครั้งที่สำรวจ').value;

        const originalTitle = document.title;
        document.title = 'แบบสำรวจ_' + location + '_' + surveyRound;

        setTimeout(() => {
            window.print();
            document.title = originalTitle;
        }, 500);
    }

    // 4. Thai date formatting
     flatpickr("#thaiDate", {
    locale: "th", // ภาษาไทย
    dateFormat: "j F Y", // เช่น 10 มกราคม 2568
    disableMobile: true, // บังคับใช้ Flatpickr แม้บนมือถือ
    onChange: function(selectedDates, dateStr, instance) {
      // แปลง ค.ศ. เป็น พ.ศ.
      const date = selectedDates[0];
      if (date) {
        const day = date.getDate();
        const monthNames = [
          "มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน",
          "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"
        ];
        const month = monthNames[date.getMonth()];
        const year = date.getFullYear() + 543;

        instance.input.value = `${day} ${month} ${year}`;
      }
    }
  });

    // 5. Reset form
    function resetForm() {
        document.querySelectorAll('input[type="text"], input[list]').forEach(input => input.value = '');
        document.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
        document.querySelectorAll('textarea').forEach(textarea => textarea.value = '');
        document.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
        alert("ล้างฟอร์ม....");
    }
</script>

<!-- External script libraries -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd


</html>